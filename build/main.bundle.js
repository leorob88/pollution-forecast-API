(()=>{var e,t;const n={enableHighAccuracy:!0,maximumAge:3e4,timeout:27e3};function o(n,o){console.log(n+" "+o);const a=n*Math.PI/180,i=e*Math.PI/180,r=(e-n)*Math.PI/180,s=(t-o)*Math.PI/180,l=Math.sin(r/2)*Math.sin(r/2)+Math.cos(a)*Math.cos(i)*Math.sin(s/2)*Math.sin(s/2),u=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3/1e3;return Math.round(u)}function a(e){return e>300?"hazardous":e>200?"very unhealthy":e>150?"unhealthy":e>100?"unhealthy for sensitive groups":e>50?"moderate":"good"}function i(n,r){console.log(n),fetch(`/.netlify/functions/lambda?${n}`).then((e=>e.json())).then((n=>{if(console.log(n),"Unknown station"==n.data||0==n.data.length)1==r?(document.getElementById("answer").innerHTML="I couldn't find any stations for pollution detection in the location you searched for.",confirm("Wanna try keyword search?")&&i(`custom=${document.getElementById("query").value}`,2)):2==r?(document.getElementById("answer").innerHTML="I couldn't find any stations for pollution detection. Be sure to provide a proper location keyword.",confirm("Wanna try geolocation?")&&i(`latit=${e}&longi=${t}`,3)):3==r&&(document.getElementById("answer").innerHTML="I couldn't find any stations for pollution detection. Be sure to provide your current position",confirm("Wanna try name search?")&&i(`city=${document.getElementById("query").value}`,1));else if(2==r){console.log("array "+n.data.length),n.data.length,currentResult=n.data[0];let e=currentResult.aqi,t=o(currentResult.station.geo[0],currentResult.station.geo[1]);document.getElementById("answer").innerHTML=`The estimated AQI for ${currentResult.station.name} has a value of ${e}. The pollution rate is ${a(e)}.`,null==t&&null==t||(document.getElementById("answer").innerHTML+=`The estimated distance from your position is about ${t} kilometers.`)}else{let e=n.data.aqi,t=o(n.data.city.geo[0],n.data.city.geo[1]);1==r?document.getElementById("answer").innerHTML=`The estimated AQI for ${n.data.city.name} has a value of ${e}. The pollution rate is ${a(e)}.`:3==r&&(document.getElementById("answer").innerHTML=`The nearest station to your estimated position is in ${n.data.city.name}. The estimated AQI has a value of ${e}. The pollution rate is ${a(e)}.`),null==t&&null==t||(document.getElementById("answer").innerHTML+=`The estimated distance from your position is about ${t} kilometers.`)}document.getElementById("answer").innerHTML+=' For further details, you can check out the reference website infos <a target="_blank" href="https://www.airnow.gov/aqi/aqi-basics/">here</a>.'}))}new Promise(((e,t)=>navigator.geolocation.getCurrentPosition(e,t,n))).then((n=>{e=n.coords.latitude,t=n.coords.longitude})).catch((e=>{console.log(e)})),document.getElementById("butt0").addEventListener("click",(function(){i(`city=${document.getElementById("query").value}`,1)})),document.getElementById("butt1").addEventListener("click",(function(){i(`custom=${document.getElementById("query").value}`,2)})),document.getElementById("butt2").addEventListener("click",(function(){i(`latit=${e}&longi=${t}`,3)}))})();